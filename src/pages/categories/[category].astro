---
import { getCollection } from 'astro:content';
import RootLayout from '../../layouts/RootLayout.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import { BLOG_INFO } from '../../consts';

export async function getStaticPaths() {
	const allPosts = await getCollection('blog');
	const uniqueCategories = [...new Set(allPosts.flatMap((post) => post.data.categories || []))];

	return uniqueCategories.map((category) => {
		const filteredPosts = allPosts.filter((post) => 
			post.data.categories?.includes(category)
		).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

		return {
			params: { category },
			props: { posts: filteredPosts },
		};
	});
}

const { category } = Astro.params;
const { posts } = Astro.props;
---

<RootLayout 
	title={`${category} - ${BLOG_INFO.title}`} 
	description={`Posts categorized with ${category}`}
>
	<div class="category-page">
		<h3>{category}</h3>
		<p class="count">{posts.length} {posts.length === 1 ? 'post' : 'posts'} found</p>
		
		<div class="posts-grid">
			{
				posts.map((post) => (
					<article class="post-card">
						<a href={`/henry-blog/blog/${post.id}`}>
							<h2 class="post-title">{post.data.title}</h2>
							<p class="post-description">{post.data.description}</p>
							<div class="post-meta">
								<FormattedDate date={post.data.pubDate} />
								{post.data.categories && (
									<div class="categories">
										{post.data.categories.map((category) => (
											<span class="category">{category}</span>
										))}
									</div>
								)}
							</div>
						</a>
					</article>
				))
			}
		</div>
	</div>
</RootLayout>

<style>
	.category-page {
		width: 100%;
	}

	h1 {
		margin-bottom: 0.5rem;
		color: rgb(var(--black));
	}
	
	h1 span {
		color: var(--accent);
	}
	
	.count {
		color: rgb(var(--gray));
		margin-bottom: 2rem;
		font-size: 0.95rem;
	}

	.posts-grid {
		display: grid;
		gap: 1.5rem;
	}

	.post-card {
		background: white;
		border: 1px solid rgb(var(--gray-light));
		border-radius: 12px;
		padding: 1.5rem;
		transition: all 0.2s ease;
	}

	.post-card:hover {
		box-shadow: 0 4px 12px rgba(var(--gray), 0.15);
		border-color: var(--accent);
	}

	.post-card a {
		text-decoration: none;
		color: inherit;
		display: block;
	}

	.post-title {
		margin: 0 0 0.75rem 0;
		color: rgb(var(--black));
		font-size: 1.5rem;
		transition: color 0.2s;
	}

	.post-card:hover .post-title {
		color: var(--accent);
	}

	.post-description {
		margin: 0 0 1rem 0;
		color: rgb(var(--gray-dark));
		line-height: 1.6;
	}

	.post-meta {
		display: flex;
		align-items: center;
		gap: 1rem;
		flex-wrap: wrap;
		font-size: 0.9rem;
		color: rgb(var(--gray));
	}

	.categories {
		display: flex;
		gap: 0.5rem;
		flex-wrap: wrap;
	}

	.category {
		background: rgb(var(--gray-light));
		color: rgb(var(--gray-dark));
		padding: 0.25rem 0.75rem;
		border-radius: 12px;
		font-size: 0.85rem;
	}

	@media (max-width: 768px) {
		.post-card {
			padding: 1rem;
		}

		.post-title {
			font-size: 1.25rem;
		}
	}
</style>
