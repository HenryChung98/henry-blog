---
import { type InferGetStaticPropsType, type GetStaticPaths, type GetStaticPathsOptions } from 'astro';
import { getCollection } from 'astro:content';
import RootLayout from '../../../layouts/RootLayout.astro';
import Pagination from '../../../components/Pagination.astro';
import PostCard from '../../../components/PostCard.astro';
import { BLOG_INFO } from '../../../consts';

export const getStaticPaths = (async ({ paginate }: GetStaticPathsOptions) => {
	const allPosts = await getCollection('blog');
	const uniqueCategories = [...new Set(allPosts.flatMap((post) => post.data.categories || []))];

	return uniqueCategories.flatMap((category) => {
		const filteredPosts = allPosts.filter((post) => 
			post.data.categories?.includes(category)
		).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

		return paginate(filteredPosts, {
			params: { category },
			pageSize: 5
		});
	});
}) satisfies GetStaticPaths;


type Props = InferGetStaticPropsType<typeof getStaticPaths>;

const { category } = Astro.params;
const { page } = Astro.props as Props;
---

<RootLayout 
	title={`${category} - ${BLOG_INFO.title}`} 
	description={`Posts categorized with ${category}`}
>
	<div class="category-page">
		<h3>{category}</h3>
		<p class="count">{page.total} {page.total === 1 ? 'post' : 'posts'} found</p>
		
		<div class="posts-grid">
			{
				page.data.map((post) => (
					<PostCard post={post} />
				))
			}
		</div>

		<Pagination page={page} />
	</div>
</RootLayout>

<style>
	.category-page {
		width: 100%;
	}

	h3 {
		margin-bottom: 0.5rem;
	}
	
	.count {
		color: var(--muted-foreground);
		margin-bottom: 2rem;
		font-size: 0.95rem;
	}

	.posts-grid {
		display: grid;
		gap: 1.5rem;
	}
</style>

